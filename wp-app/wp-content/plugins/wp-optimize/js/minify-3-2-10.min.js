!function(e){function t(t){var n=e(t).serializeArray().reduce(i,{});return e(t).find('input[type="checkbox"]').each(function(t){var i=e(this).prop("name");if(i.includes("[]")){if(!e(this).is(":checked"))return;var s=i.replace("[]","");n[s]||(n[s]=[]),n[s].push(e(this).val())}else n[i]=e(this).is(":checked")?"true":"false"}),n}function i(e,t){return t.name.includes("[]")?e:(e[t.name]=t.value,e)}var n=window.wp_optimize||{},s=n.send_command,a=wpoptimize.refresh_frequency||3e4;if(!s)return void console.error("WP-Optimize Minify: wp_optimize.send_command is required.");var o={};o.init=function(){function i(e){return e.data("url")}function a(t){var i=e("#exclude_js"),n=i.val();n+=t+"\n",i.val(n)}function o(t){var i=e("#exclude_css"),n=i.val();n+=t+"\n",i.val(n)}function l(t){var i=t.data("url"),n=e("#async_js"),s=n.val();s+=i+"\n",n.val(s),p("js"),r(t)}function c(t){var i=t.data("url"),n=e("#async_css"),s=n.val();s+=i+"\n",n.val(s),p("css"),r(t)}function p(t){e("#wp-optimize-nav-tab-wpo_minify-"+t+"-contents form").data("need_saving",!0)}function r(t){t.closest(".wpo_min_log").prev().removeClass("hidden").addClass("updated").slideDown(),t.text(wpoptimize.added_to_list),t.removeClass("exclude"),t.parent().addClass("disable-list-item"),t.replaceWith(e("<span>"+t.text()+"</span>"))}function d(t){e('input[name="enable_defer_js"]').each(function(t,i){e(i).closest("fieldset").removeClass("selected").find(".defer-js-settings").slideUp("fast")}),e('input[name="enable_defer_js"]:checked').closest("fieldset").addClass("selected").find(".defer-js-settings").slideDown("fast")}function f(){v||(v=setInterval(function(){u()},5e3))}function u(){s("get_minify_preload_status",null,function(e){e.done?(h.val(wpoptimize.run_now),h.data("running",!1),clearInterval(v),v=null):(h.val(wpoptimize.cancel),h.data("running",!0)),w.text(e.message),_(e)})}function _(t){e("#wpo_min_cache_size").text(t.size),e("#wpo_min_cache_total_size").text(t.total_size)}var m=this;this.enabled=!1,e(document).on("wp-optimize/minify/toggle-status",function(t,i){i.hasOwnProperty("enabled")&&(e('[data-whichpage="wpo_minify"]').toggleClass("is-enabled",i.enabled),m.enabled=i.enabled,m.enabled&&m.getFiles())}),e(".purge_minify_cache").on("click",function(t){t.preventDefault(),e.blockUI(),s("purge_minify_cache",null,function(e){e.hasOwnProperty("files")&&(m.updateFilesLists(e.files),m.updateStats(e.files))}).always(function(){e.unblockUI()})}),e(".purge_all_minify_cache").on("click",function(){e.blockUI(),s("purge_all_minify_cache",null,function(e){e.hasOwnProperty("files")&&(m.updateFilesLists(e.files),m.updateStats(e.files))}).always(function(){e.unblockUI()})}),e(".minify_increment_cache").on("click",function(){e.blockUI(),s("minify_increment_cache",null,function(e){e.hasOwnProperty("files")&&(m.updateFilesLists(e.files),m.updateStats(e.files))}).always(function(){e.unblockUI()})}),e("#wp-optimize-nav-tab-wpo_minify-status-contents form :input, #wp-optimize-nav-tab-wpo_minify-js-contents form :input, #wp-optimize-nav-tab-wpo_minify-css-contents form :input, #wp-optimize-nav-tab-wpo_minify-font-contents form :input, #wp-optimize-nav-tab-wpo_minify-settings-contents form :input, #wp-optimize-nav-tab-wpo_minify-advanced-contents form :input").on("change",function(){e(this).closest("form").data("need_saving",!0)}),e("input[type=checkbox].wpo-save-setting").on("change",function(t){var i=e(this),n=i.prop("checked"),a=i.prop("name"),o={};o[a]=n,e.blockUI(),s("save_minify_settings",o,function(e){e.success?(i.trigger("wp-optimize/minify/saved_setting"),e.hasOwnProperty("files")&&(m.updateFilesLists(e.files),m.updateStats(e.files))):console.log("Settings not saved",o)}).always(function(){e.unblockUI()})}),e("#wpo_min_enable_minify").on("wp-optimize/minify/saved_setting",function(){this.enabled=e(this).prop("checked"),e(document).trigger("wp-optimize/minify/toggle-status",{enabled:this.enabled})}),e("#wpo_min_enable_minify").on("wp-optimize/minify/saved_setting",function(){e(this).closest(".wpo_section").toggleClass("wpo-feature-is-disabled",!e(this).is(":checked"))}),e("#wpo_min_enable_minify_css, #wpo_min_enable_minify_js").on("wp-optimize/minify/saved_setting",function(){e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="'+e(this).data("tabname")+'"] span.disabled').toggleClass("hidden",e(this).is(":checked"))}).each(function(){e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="'+e(this).data("tabname")+'"] span.disabled').toggleClass("hidden",e(this).is(":checked"))}),e("#wpo_min_enable_minify_debug").on("wp-optimize/minify/saved_setting",function(){e.blockUI({message:"<h1>"+wpoptimize.page_refresh+"</h1>"}),location.href=e("#wp-optimize-nav-tab-wpo_minify-advanced").prop("href")}),e("#wpo_min_edit_default_exclutions").on("wp-optimize/minify/saved_setting",function(){e(".wpo-minify-default-exclusions").toggleClass("hidden",!e(this).prop("checked"))}),e(".wp-optimize-save-minify-settings").on("click",function(i){i.preventDefault();var a=e(this),o=a.next(),l=o.next();o.show(),e.blockUI();var c={},p=e('[data-whichpage="wpo_minify"] .wp-optimize-nav-tab-contents form');p.each(function(){var i=e(this);!0===i.data("need_saving")&&(c=Object.assign(c,t(i)),i.data("need_saving",!1))}),s("save_minify_settings",c,function(t){t.hasOwnProperty("error")?(console.log(t.error),n.notices.show_notice(t.success,t.error)):e(".wpo-error__enabling-cache").addClass("wpo_hidden").find("p").text(""),t.hasOwnProperty("files")&&(m.updateFilesLists(t.files),m.updateStats(t.files)),o.hide(),l.show(),setTimeout(function(){l.fadeOut("slow",function(){l.hide()})},5e3)}).always(function(){e.unblockUI()})}),e(".wp-optimize-minify-status-information-notice").on("click",".notice-dismiss",function(e){e.preventDefault(),s("hide_minify_notice")}),e("#wpo_min_jsprocessed, #wpo_min_cssprocessed").on("click",".log",function(t){t.preventDefault(),e(this).nextAll(".wpo_min_log").slideToggle("fast")}),e("#wpo_min_jsprocessed, #wpo_min_cssprocessed").on("click",".delete-file",function(t){t.preventDefault();var i=e(this).data("filename");return""===i||void 0===i?(alert(wpoptimize.cache_file_not_found),!1):(e.blockUI(),void s("delete_minify_cache_file",i,function(e){""!==e.files&&(m.updateFilesLists(e.files),m.updateStats(e.files)),""!==e.result&&alert(e.result),""!==e.error&&alert(e.error)}).always(function(){e.unblockUI()}))}),e("#wpo_min_jsprocessed").on("click",".exclude",function(t){t.preventDefault();var n=e(this),s=i(n);a(s),p("js"),r(n)}),e("#wpo_min_cssprocessed").on("click",".exclude",function(t){t.preventDefault();var n=e(this),s=i(n);o(s),p("css"),r(n)}),e("#wpo_min_jsprocessed").on("click",".defer",function(t){t.preventDefault(),l(e(this))}),e("#wpo_min_cssprocessed").on("click",".async",function(t){t.preventDefault(),c(e(this))}),e("#wp-optimize-minify-advanced").on("click",".save-exclusions",function(t){t.preventDefault(),e(".wp-optimize-save-minify-settings").first().trigger("click")}),this.enabled=e("#wpo_min_enable_minify").prop("checked"),e(document).trigger("wp-optimize/minify/toggle-status",{enabled:this.enabled}),this.enabled||e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="status"]').is(".nav-tab-active")||e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="status"]').trigger("click"),e('input[name="enable_defer_js"]').on("change",d),d();var h=e("#wp_optimize_run_minify_preload"),w=e("#wp_optimize_preload_minify_status"),v=null;return h.on("click",function(){var t=e(this),i=t.data("running"),n=w.text();t.prop("disabled",!0),i?(t.data("running",!1),clearInterval(v),v=null,s("cancel_minify_preload",null,function(e){e&&e.hasOwnProperty("message")&&w.text(e.message)}).always(function(){t.val(wpoptimize.run_now),t.prop("disabled",!1)})):(w.text(wpoptimize.starting_preload),t.data("running",!0),s("run_minify_preload",null,null,!0,{timeout:3e3}).always(function(e){try{var i=wpo_parse_json(e)}catch(s){}if(i&&i.error){var a=wpoptimize.error_unexpected_response;return"function"!=typeof i.error?a=i.error:i.status&&(a=i.status+": "+i.statusText),alert(a),w.text(n),t.prop("disabled",!1),void t.data("running",!1)}w.text(wpoptimize.loading_urls),t.val(wpoptimize.cancel),t.prop("disabled",!1),f()}))}),h.data("running")&&f(),this},o.getFiles=function(){if(this.enabled){var e={stamp:(new Date).getTime()};s("get_minify_cached_files",e,function(e){o.updateFilesLists(e),o.updateStats(e)}),a&&setTimeout(o.getFiles.bind(this),a)}},o.updateFilesLists=function(t){if(null!==t){var i=[];t.js.length>0&&e(t.js).each(function(){i.push(this.uid),0==e("#"+this.uid).length&&e("#wpo_min_jsprocessed ul.processed").append('\t\t\t\t\t<li id="'+this.uid+'">\t\t\t\t\t\t<span class="filename"><a href="'+this.file_url+'" target="_blank">'+this.filename+"</a> ("+this.fsize+')</span>\t\t\t\t\t\t<a href="#" class="log">'+wpoptimize.toggle_info+'</a>\t\t\t\t\t\t<a href="#" class="delete-file" data-filename="'+this.filename+'">'+wpoptimize.delete_file+'</a>\t\t\t\t\t\t<div class="hidden save_notice">\t\t\t\t\t\t\t<p>'+wpoptimize.added_notice+'</p>\t\t\t\t\t\t\t<p><button class="button button-primary save-exclusions">'+wpoptimize.save_notice+'</button></p>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="hidden wpo_min_log">'+this.log+"</div>\t\t\t\t\t</li>\t\t\t\t")}),e("#wpo_min_jsprocessed ul.processed .no-files-yet").toggle(!t.js.length),t.css.length>0&&e(t.css).each(function(){i.push(this.uid),0==e("#"+this.uid).length&&e("#wpo_min_cssprocessed ul.processed").append('\t\t\t\t\t<li id="'+this.uid+'">\t\t\t\t\t\t<span class="filename"><a href="'+this.file_url+'" target="_blank">'+this.filename+"</a> ("+this.fsize+')</span>\t\t\t\t\t\t<a href="#" class="log">'+wpoptimize.toggle_info+'</a>\t\t\t\t\t\t<a href="#" class="delete-file" data-filename="'+this.filename+'">'+wpoptimize.delete_file+'</a>\t\t\t\t\t\t<div class="hidden save_notice">\t\t\t\t\t\t\t<p>'+wpoptimize.added_to_list+'</p>\t\t\t\t\t\t\t<p><button class="button button-primary save-exclusions">'+wpoptimize.save_notice+'</button></p>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="hidden wpo_min_log">'+this.log+"</div>\t\t\t\t\t</li>\t\t\t\t")}),e("#wpo_min_cssprocessed ul.processed .no-files-yet").toggle(!t.css.length),e("#wpo_min_jsprocessed ul.processed > li, #wpo_min_cssprocessed ul.processed > li").each(function(){-1==jQuery.inArray(e(this).attr("id"),i)&&(e(this).is(".no-files-yet")||e(this).remove())})}},o.updateStats=function(t){t.cachesize.length>0&&(e("#wpo_min_cache_size").html(this.enabled?t.cachesize:wpoptimize.no_minified_assets),e("#wpo_min_cache_total_size").html(this.enabled?t.total_cache_size:wpoptimize.no_minified_assets),e("#wpo_min_cache_time").html(this.enabled?t.cacheTime:"-"),e("#wpo_min_cache_path").html(t.cachePath))},n.minify_settings=function(){var i=e('[data-whichpage="wpo_minify"] .wp-optimize-nav-tab-contents form'),n={};return i.each(function(){var i=e(this);n=Object.assign(n,t(i))}),n},n.minify=o}(jQuery);